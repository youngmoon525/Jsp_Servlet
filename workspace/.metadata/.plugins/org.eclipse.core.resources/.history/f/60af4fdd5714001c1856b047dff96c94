<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BookMain JSP</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="jquery/jquery-3.6.0.min.js"></script>
<script>
var isbnCheck = 0;
$(function(){
	$("#isbn").keyup(function(){
		var isbn = document.querySelector("#isbn").value;
		//alert("ISBN : " + isbn);
		var regIsbn = /^\d{3}[\-]\d{2}[\-]\d{4}[\-]\d{3}[\-]\d{1}$/;
		
		if(!regIsbn.test(isbn)){	//ISBN 유효성검사
			var msg = "ISBN 코드형식이 잘못되었습니다!"
			$("#isbnCheck").text(msg);
			$("#isbnCheck").css("color", "red");
			$("#isbn").focus();
		}else{	//ISBN 중복검사
			var check = true;
			$.ajax({
				dataType : "json",
				url : "isbnList.jsp",
				success : function(data){
					//alert("JSON 로딩 성공!");
					$.each(data, function(key, value){
						if(isbn == value.isbn){
							check = false;
						}
						fnCheck(check);
					});//each()
				},
				error : function(){alert("JSON 로딩실패!");}
			});//ajax()
		}
	});//keyup()
});	//ready()

function fnCheck(check){
	if(!check){
		var msg = "등록된 ISBN 입니다!";
		$("#isbnCheck").text(msg);
		$("#isbnCheck").css("display", "block");
		$("#isbnCheck").css("color", "red");
	}else{
		var msg = "사용가능한 ISBN 입니다!";
		$("#isbnCheck").text(msg);
		$("#isbnCheck").css("color", "blue");
		isbnCheck = 1;
	}
}//fnCheck()

function fnSubmit(){
	alert("IsbnCheck : " + isbnCheck);
	if(isbnCheck == 0){
		alert("ISBN 코드가 양식에 맞지 않습니다.");
		return false;
	}else{
		if(confirm("도서정보를 등록하시겠습니까?")){
			return true;
		}
		return false;
	}
}//fnSubmit()

function fnReset(){
	var msg = "입력하신 내용이 초기화 됩니다.";
	msg += "\n계속 진행하시겠습니까?";
	if(confirm(msg)){
		return true;
	}
	return false;
}//fnReset()
</script>
</head>
<body>
<div align="center">
<h3>[도서정보 입력화면]</h3>
<form action="insert.jsp" method="post" onsubmit="return fnSubmit()" onreset="return fnReset()">
	<table border="1">
		<tr>
			<th>도서명</th>
			<td><input type="text" name="title" required="required"/></td>
		</tr>
		<tr>
			<th>저자</th>
			<td><input type="text" name="name" required="required"/></td>
		</tr>
		<tr>
			<th>ISBN</th>
			<td>
				<input type="text" name="isbn" required="required"
					placeholder="xxx-xx-xxxx-xxx-x" id="isbn"/>
				<span id="isbnCheck"></span><!-- ISBN 유효성검사 및 중복여부 -->		
			</td>
		</tr>
		<tr>
			<th>출판사</th>
			<td><input type="text" name="company" required="required"/></td>			
		</tr>
		<tr>
			<th>단가</th>
			<td><input type="number" name="cost" min="0" value="0"/></td>
		</tr>
		<tr>
			<th>수량</th>
			<td><input type="number" name="qty" min="0" value="0"/></td>
		</tr>
		<tr>
			<td colspan="2" align="center">
				<input type="submit" value="도서정보입력"/>
				<input type="reset" value="입력정보취소"/>
				<input type="button" value="전체도서보기" onclick="location.href='getAllList.jsp'"/>
			</td>
		</tr>
	</table>
</form>
</div>
</body>
</html>